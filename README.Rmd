---
title: "README"
author: "jmhatch"
output: md_document
params:
  date: !r Sys.Date()
---

```{r setup, include = FALSE}
  knitr::opts_chunk$set(echo = FALSE)

# load libraries
library(dplyr)
```

```{r header, results = 'asis'}
cat(paste0("# Trends in COVID-19 for counties in the U.S. state of Massachusetts (updated on ", params$date, ")\n"))
```

![trends in covid-19 cases by county in the U.S. state of massachusetts](./images/ma_county_covid.png)

## County-level Information

| County | Level | Date Updated |
| :--- | :---: | :---: |
```{r county, results = 'asis'}
# ma counties
ma_counties = c('Barnstable', 'Berkshire', 'Bristol', 'Essex', 'Franklin', 'Hampden', 'Hampshire', 'Middlesex', 'Norfolk', 'Plymouth', 'Suffolk', 'Worcester')

# load cdc community level data
cdc_ma = read.csv('./data/cdc-community-ma-counties.csv', header = TRUE)

# function to print out md
md_txt = function(i) {
  
    # filter data for county
    cty_cdc = cdc_ma %>% filter(county == paste0(i, ' County, MA')) %>% pull(covid.19_community_level)
    
    # date updated
    cty_date = cdc_ma %>% filter(county == paste0(i, ' County, MA')) %>% pull(date_updated)
    
    # set color based on community level
    cty_level = case_when(cty_cdc == 'Low' ~ 'success', 
                          cty_cdc == 'Medium' ~ 'important',
                          cty_cdc == 'High' ~ 'critical')
    
    # md text
    paste0(
      '| ', i, ' County | ', 
      '[![', tolower(i), ' cdc community badge](https://img.shields.io/badge/CDC%20Community%20Level-', cty_cdc, '-', cty_level, '.svg)](https://www.cdc.gov/coronavirus/2019-ncov/science/community-levels.html) | ', cty_date, ' | \n'
    )
  
}

# loop through 
for(i in ma_counties) cat(md_txt(i))
```
name: update-covid-19-repo

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  schedule:
    - cron: '00 23 * * *' # at 23:00

jobs:
  covid-19-update:
    runs-on: windows-latest
    strategy:
      matrix:
        R: [ '4.0.3' ]
    name: R ${{ matrix.R }} sample
    steps:
      - uses: actions/checkout@v2
      - name: Setup R
        uses: r-lib/actions/setup-r@v1
        with:
          r-version: ${{ matrix.R }}
          
      - name: Setup pandoc
        uses: r-lib/actions/setup-pandoc@v1
        
      - name: Install r dependencies
        run: |
           install.packages(c("dplyr", "readr", "magrittr", "ggplot2", "RcppRoll", "gghighlight", "rmarkdown", "scales"))
        shell: Rscript {0}
  
      - name: Download data from nyt 
        run: |
          source('./scripts/download_covid_data_from_nyt.R')
        shell: Rscript {0}
        
      - name: Process data from nyt 
        run: |
          source('./scripts/process_covid_data_from_nyt.R')
        shell: Rscript {0}        
        
      - name: Plot data from nty
        run: |
          source('./scripts/plot_covid_data_from_nyt.R')
        shell: Rscript {0}
        
      - name: Render README
        run: Rscript -e 'rmarkdown::render("./README.Rmd")'

      - uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: updated repo
